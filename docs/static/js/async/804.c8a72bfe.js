"use strict";(self.webpackChunkrspress=self.webpackChunkrspress||[]).push([["804"],{7511:function(e,n,s){s.r(n),s.d(n,{default:()=>a});var r=s(5893),i=s(65);function t(e){let n=Object.assign({h1:"h1",a:"a",p:"p",img:"img",h2:"h2",ul:"ul",li:"li",strong:"strong",code:"code",pre:"pre",h3:"h3"},(0,i.ah)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.h1,{id:"leachainvm-shim",children:["@leachain/vm-shim",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#leachainvm-shim",children:"#"})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://www.npmjs.com/package/@leachain/vm-shim",target:"_blank",rel:"noopener noreferrer",children:(0,r.jsx)(n.img,{src:"https://img.shields.io/npm/v/@leachain/vm-shim",alt:"npm version"})}),"\n",(0,r.jsx)(n.a,{href:"https://github.com/LEA-Blockchain/vm-shim/blob/main/LICENSE",target:"_blank",rel:"noopener noreferrer",children:(0,r.jsx)(n.img,{src:"https://img.shields.io/github/license/LEA-Blockchain/vm-shim",alt:"GitHub license"})})]}),"\n",(0,r.jsx)(n.p,{children:"@leachain/vm-shim is a reusable VM shim for Lea-chain WebAssembly modules, providing the necessary host environment for running smart contracts compatibly in both Node.js and browser environments."}),"\n",(0,r.jsxs)(n.h2,{id:"features",children:["Features",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#features",children:"#"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Environment-Agnostic"}),": Works seamlessly in both Node.js and modern web browsers."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Secure by Default"}),": Provides a sandboxed environment with no filesystem or network access unless explicitly passed in."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Configurable"}),": Allows custom handlers for events like ",(0,r.jsx)(n.code,{children:"abort"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Typed API"}),": Includes TypeScript definitions for a better developer experience."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Modern Tooling"}),": Bundled with ",(0,r.jsx)(n.code,{children:"esbuild"})," for optimized, multi-format output (ESM, CJS, and IIFE)."]}),"\n"]}),"\n",(0,r.jsxs)(n.h2,{id:"installation",children:["Installation",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#installation",children:"#"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"npm install @leachain/vm-shim\n"})}),"\n",(0,r.jsxs)(n.h2,{id:"usage",children:["Usage",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#usage",children:"#"})]}),"\n",(0,r.jsxs)(n.p,{children:["The primary export is ",(0,r.jsx)(n.code,{children:"createShim"}),", which generates the ",(0,r.jsx)(n.code,{children:"importObject"})," for a WebAssembly instance."]}),"\n",(0,r.jsxs)(n.h3,{id:"es-modules-esm",children:["ES Modules (ESM)",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#es-modules-esm",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"This is the recommended approach for modern Node.js and browser bundlers."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"import { promises as fs } from 'fs';\nimport { createShim } from '@leachain/vm-shim';\n\nasync function runWasm() {\n    // 1. Create the shim instance\n    const { importObject, bindInstance } = createShim();\n\n    // 2. Read your Wasm module bytes\n    const wasmBytes = await fs.readFile('./path/to/your_contract.wasm');\n\n    // 3. Instantiate the module with the shim's import object\n    const { instance } = await WebAssembly.instantiate(wasmBytes, importObject);\n\n    // 4. IMPORTANT: Bind the created instance to the shim\n    // This allows host functions to access the Wasm module's memory.\n    bindInstance(instance);\n\n    // 5. Call an exported function from your Wasm module\n    const result = instance.exports.your_function(123);\n    console.log(`Wasm function returned: ${result}`);\n}\n\nrunWasm().catch(console.error);\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"commonjs-cjs",children:["CommonJS (CJS)",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#commonjs-cjs",children:"#"})]}),"\n",(0,r.jsxs)(n.p,{children:["For older Node.js environments, you can use ",(0,r.jsx)(n.code,{children:"require"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"const { promises: fs } = require('fs');\nconst { createShim } = require('@leachain/vm-shim');\n\nasync function runWasm() {\n    // 1. Create the shim instance\n    const { importObject, bindInstance } = createShim();\n\n    // 2. Read your Wasm module bytes\n    const wasmBytes = await fs.readFile('./path/to/your_contract.wasm');\n\n    // 3. Instantiate the module with the shim's import object\n    const { instance } = await WebAssembly.instantiate(wasmBytes, importObject);\n\n    // 4. IMPORTANT: Bind the created instance to the shim\n    bindInstance(instance);\n\n    // 5. Call an exported function from your Wasm module\n    const result = instance.exports.your_function(123);\n    console.log(`Wasm function returned: ${result}`);\n}\n\nrunWasm().catch(console.error);\n"})}),"\n",(0,r.jsxs)(n.h2,{id:"api-reference",children:["API Reference",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#api-reference",children:"#"})]}),"\n",(0,r.jsxs)(n.h3,{id:"createshimconfig",children:[(0,r.jsx)(n.code,{children:"createShim(config?)"}),(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#createshimconfig",children:"#"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"config"})," ",(0,r.jsx)(n.code,{children:"<object>"})," (Optional)","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"onAbort"})," ",(0,r.jsx)(n.code,{children:"<(message: string) => void>"}),": A custom handler to call when the Wasm module aborts. Defaults to ",(0,r.jsx)(n.code,{children:"process.exit(1)"})," in Node.js and throws an ",(0,r.jsx)(n.code,{children:"Error"})," in the browser."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Returns"})," ",(0,r.jsx)(n.code,{children:"<object>"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"importObject"})," ",(0,r.jsx)(n.code,{children:"<object>"}),": The WebAssembly import object. Pass this to ",(0,r.jsx)(n.code,{children:"WebAssembly.instantiate"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"bindInstance"})," ",(0,r.jsx)(n.code,{children:"<(instance: WebAssembly.Instance) => void>"}),": A function to bind the newly created Wasm instance to the shim. ",(0,r.jsx)(n.strong,{children:"This must be called after instantiation."})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"print"})," ",(0,r.jsx)(n.code,{children:"<object>"}),": A colored logging utility with ",(0,r.jsx)(n.code,{children:"red"}),", ",(0,r.jsx)(n.code,{children:"orange"}),", ",(0,r.jsx)(n.code,{children:"green"}),", and ",(0,r.jsx)(n.code,{children:"blue"})," methods."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"cstringmemory-ptr",children:[(0,r.jsx)(n.code,{children:"cstring(memory, ptr)"}),(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#cstringmemory-ptr",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"A utility function to read a null-terminated UTF-8 string from the Wasm instance's memory."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"memory"})," ",(0,r.jsx)(n.code,{children:"<WebAssembly.Memory>"}),": The exported memory from your Wasm instance (",(0,r.jsx)(n.code,{children:"instance.exports.memory"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ptr"})," ",(0,r.jsx)(n.code,{children:"<number>"}),": The pointer (memory address) of the string."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Returns"})," ",(0,r.jsx)(n.code,{children:"<string>"}),": The decoded string."]}),"\n"]}),"\n",(0,r.jsxs)(n.h2,{id:"contributing",children:["Contributing",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#contributing",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"Contributions are welcome! Please open an issue or submit a pull request for any bugs, features, or improvements."}),"\n",(0,r.jsxs)(n.h2,{id:"license",children:["License",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#license",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"This project is licensed under the ISC License."})]})}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,i.ah)(),e.components);return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(t,{...e})}):t(e)}let a=c;c.__RSPRESS_PAGE_META={},c.__RSPRESS_PAGE_META["npm-module%2Fgenerated%2Fvm-shim.md"]={toc:[{text:"Features",id:"features",depth:2},{text:"Installation",id:"installation",depth:2},{text:"Usage",id:"usage",depth:2},{text:"ES Modules (ESM)",id:"es-modules-esm",depth:3},{text:"CommonJS (CJS)",id:"commonjs-cjs",depth:3},{text:"API Reference",id:"api-reference",depth:2},{text:"`createShim(config?)`",id:"createshimconfig",depth:3},{text:"`cstring(memory, ptr)`",id:"cstringmemory-ptr",depth:3},{text:"Contributing",id:"contributing",depth:2},{text:"License",id:"license",depth:2}],title:"@leachain/vm-shim",headingTitle:"@leachain/vm-shim",frontmatter:{}}}}]);